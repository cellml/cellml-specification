<variable name="t" units="dimensionless" />
<variable name="x" units="dimensionless" />
<variable name="y" units="dimensionless" initial_value="0" />
<variable name="r" units="dimensionless" />
<!-- Include a sign variable to reset the value of r to pass to the reset for y.-->
<variable name="r_sign" units="dimensionless" />

<math>
  <apply>
    <eq/>
    <ci>x</ci>
    <apply>
      <sin/>
      <apply>
        <times/>
        <ci>t</ci>
        <pi/>
      </apply>
    </apply>
  </apply>

  <!-- Include the evaluation of the additional variable in the MathML block.
         The value of r will change each iteration, but will only be passed on to
         the y variable when the reset conditions are met. -->
  <apply>
    <eq/>
    <ci>r_sign</ci>
    <apply>
      <divide/>
      <!-- Potential for divide by zero! Danger! -->
      <apply>
        <abs/>
        <apply>
          <sin/>
          <apply>
            <times/>
            <apply>
              <minus/>
              <ci>t</ci>
              <cn cellml:units="dimensionless">0.1</cn>
            </apply>
            <pi/>
          </apply>
        </apply>
      </apply>
      <apply>
        <sin/>
        <apply>
          <times/>
          <apply>
            <minus/>
            <ci>t</ci>
            <cn cellml:units="dimensionless">0.1</cn>
          </apply>
          <pi/>
        </apply>
      </apply>
    </apply>
  </apply>
</math>

<!-- Two new resets which determine the value of r to be passed (when applicable) to the y variable: -->
<reset variable="r" test_variable="r_sign" order="2">
  <test_value>
    <cn cellml:units="dimensionless">1</cn>
  </test_value>
  <reset_value>
    <cn cellml:units="dimensionless">0</cn>
  </reset_value>
</reset>
<reset variable="r" test_variable="r_sign" order="1">
  <test_value>
    <cn cellml:units="dimensionless">-1</cn>
  </test_value>
  <reset_value>
    <cn cellml:units="dimensionless">1</cn>
  </reset_value>
</reset>

<reset variable="y" test_variable="x">
  <test_value>
    <cn cellml:units="dimensionless">0</cn>
  </test_value>
  <!-- The reset value now uses the pre-computed variable, r. -->
  <reset_value>
    <ci>r</ci>
  </reset_value>
</reset>